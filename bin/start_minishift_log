#!/bin/bash

status=$(minishift status)

if [ $status = "Running" ]; then
   echo "## Minishift is already running. We will log on to openshift"
else
  echo "## Start Minishift and log on to OpenShift"
  minishift start
fi

# project=$(oc project)
# if [[ $project == *default* ]]; then
#     echo "## Default project is used. This is perfect !"
# else
#     echo "## We will switch to the project default. Wait a moment ..."
#     oc project default
# fi

oc project default
oc login $(minishift ip):8443 -u admin -p admin

eval $(minishift docker-env)

echo "## Delete vertx-demo project & create a new"
oc delete project vertx-demo --now=true
sleep 2s
oc new-project vertx-demo

# echo "## Add policies"
oc policy add-role-to-user view openshift-dev -n vertx-demo
oc policy add-role-to-group view system:serviceaccounts -n vertx-demo